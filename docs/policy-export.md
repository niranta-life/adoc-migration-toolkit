# Policy Export Command

The `policy-export` command exports policy definitions by different categories from the source environment to ZIP files.

## Overview

This command processes policies from the `policies-all-export.csv` file (generated by `policy-list-export`) and exports them by different categories such as rule types, engine types, assemblies, and source types. The exported policies are saved as ZIP files for easy import to the target environment.

## Usage

```bash
policy-export [--type <export_type>] [--filter <filter_value>] [--quiet] [--verbose] [--batch-size <size>] [--parallel]
```

## Parameters

### Optional Parameters

- `--type <export_type>`: Type of policy export (default: `rule-types`)
  - `rule-types`: Export by rule type categories
  - `engine-types`: Export by engine type categories
  - `assemblies`: Export by assembly categories
  - `source-types`: Export by source type categories
- `--filter <filter_value>`: Filter policies by specific value (e.g., `JDBC_URL`, `production-db`)
- `--quiet`: Suppress detailed output (only show errors and warnings)
- `--verbose`: Show detailed processing information including API requests/responses
- `--batch-size <size>`: Number of policies to process per batch (default: 50)
- `--parallel`: Use parallel processing for faster export operations

## Export Types

### Rule Types Export
Exports policies grouped by their rule type categories:
```bash
policy-export --type rule-types
```

### Engine Types Export
Exports policies grouped by engine type with optional filtering:
```bash
policy-export --type engine-types --filter JDBC_URL
```

### Assemblies Export
Exports policies grouped by assembly with optional filtering:
```bash
policy-export --type assemblies --filter production-db
```

### Source Types Export
Exports policies grouped by source type with optional filtering:
```bash
policy-export --type source-types --filter PostgreSQL
```

## Examples

### Basic Export

```bash
policy-export
```

### Export with Specific Type

```bash
policy-export --type rule-types
```

### Export with Filter

```bash
policy-export --type engine-types --filter JDBC_URL
```

### Export with Custom Batch Size

```bash
policy-export --type rule-types --batch-size 100 --quiet
```

### Parallel Export

```bash
policy-export --type rule-types --parallel
```

### Verbose Export

```bash
policy-export --type assemblies --filter production-db --verbose
```

## Input Files

The command expects the following input file:

- `policy-export/policies-all-export.csv` - Policy data exported by `policy-list-export`

## Output Files

The command generates ZIP files in the following format:
- `<export_type>[-<filter>]-<timestamp>-<range>.zip`

Examples:
- `rule-types-20231201-001-050.zip`
- `engine-types-JDBC_URL-20231201-001-050.zip`
- `assemblies-production-db-20231201-001-050.zip`

## Workflow Integration

This command is typically used in the following workflow:

1. **Export Policies**: Use `policy-list-export` to export all policies
2. **Export by Category**: Use this command to export policies by specific categories
3. **Import Policies**: Use `policy-import` to import the ZIP files to target environment

## Error Handling

The command includes comprehensive error handling:

- **Missing Input File**: Provides clear guidance on required `policies-all-export.csv` file
- **Invalid Export Type**: Validates export type parameters
- **API Errors**: Handles authentication and permission issues
- **Network Issues**: Retries failed operations with exponential backoff
- **File System Errors**: Handles disk space and permission issues

## Performance

- **Parallel Processing**: Use `--parallel` for faster export of large datasets
- **Batch Operations**: Processes policies in configurable batches
- **Memory Management**: Efficient memory usage for large policy datasets
- **Progress Tracking**: Real-time progress indicators for long operations

## Tips

- **Prerequisites**: Always run `policy-list-export` first to generate the required input file
- **Batch Size**: Adjust batch size based on your system's memory and performance
- **Filtering**: Use filters to focus on specific policy categories
- **Parallel Processing**: Use `--parallel` for large policy datasets
- **Monitoring**: Use `--verbose` mode to monitor the export process

## Common Use Cases

### Complete Policy Migration
Export all policy types for full migration:
```bash
policy-export --type rule-types --parallel
policy-export --type engine-types --parallel
policy-export --type assemblies --parallel
```

### Selective Migration
Export specific policy categories:
```bash
policy-export --type engine-types --filter JDBC_URL --verbose
```

### Large Dataset Processing
Export large policy datasets efficiently:
```bash
policy-export --type rule-types --batch-size 100 --parallel --quiet
```

## Related Commands

- [policy-list-export](policy-list-export.md) - Export all policies to CSV file
- [policy-import](policy-import.md) - Import policy ZIP files to target environment
- [policy-xfr](policy-xfr.md) - Transform policy files with string replacements
- [rule-tag-export](rule-tag-export.md) - Export rule tags for policies 